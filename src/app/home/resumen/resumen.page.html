<ion-header>
  <ion-toolbar color='danger'>
    <ion-title class="ion-text-center">RESUMEN</ion-title>
    <ion-icon name='cloud-download' class="icon-button" color='light' slot='end' (click)='descargar()'></ion-icon>
  </ion-toolbar>
</ion-header>

<ion-content class="bg">
  <ion-card-content>
    <ion-row>
      <ion-col size='9'>
        <ion-item>
          <ion-icon name='calendar-outline' slot='start'></ion-icon>
          <ion-label>Año</ion-label>
          <ion-datetime displayFormat="YYYY" pickerFormat='YYYY' min="2019-01-01" [(ngModel)]='anio'
            (ionChange)='filtrarResumenes()'></ion-datetime>
        </ion-item>
      </ion-col>
      <ion-col>
        <ion-fab-button type='button' size='small' (click)='refresh()' color='danger'>
          <ion-icon name='refresh-outline'>
          </ion-icon>
        </ion-fab-button>
      </ion-col>
    </ion-row>

    <div *ngIf="show">
      <form [formGroup]='resumenForm' (ngSubmit)='updateResumen()'>

        <ion-row>
          <ion-col>
            <ion-item>
              <ion-label position='fixed'>Fecha</ion-label>
              <ion-input disabled [value]="resumen.Fecha | date:'MM/yyyy'">
              </ion-input>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <ion-item>
              <ion-label position='fixed'>Observación</ion-label>
              <ion-input type='text' formControlName='Observacion'></ion-input>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col size='9'>
            <ion-item>
              <ion-label position='fixed'>Foto</ion-label>
              <ion-input type='text' formControlName='NombreFoto' [value]="resumen.Fecha + '.jpg'" disabled></ion-input>

              <ion-thumbnail slot="end">
                <ion-img [src]="resumenForm.value.Foto"></ion-img>
              </ion-thumbnail>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-fab horizontal="end" size='small'>
              <ion-fab-button (click)="tomarFoto()" color='danger'>
                <ion-icon name="camera"></ion-icon>
              </ion-fab-button>
            </ion-fab>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <ion-button type='submit' expand='block' [disabled]="!resumenForm.valid" color='danger'>Guardar</ion-button>
          </ion-col>
        </ion-row>
      </form>
    </div>

    <ion-toolbar color='danger'>
      <ion-row>
        <ion-col size='6'>
          <ion-label>COMPRAS ANUAL:</ion-label>
        </ion-col>
        <ion-col class="ion-text-center">
          S/
        </ion-col>
        <ion-col class="ion-text-end">
          <ion-label>{{ sumaComprasAnual | number:'1.2-2' }} </ion-label>
        </ion-col>

      </ion-row>
    </ion-toolbar>

    <ion-toolbar color='danger'>
      <ion-row>
        <ion-col size='6'>
          <ion-label>VENTAS ANUAL:</ion-label>
        </ion-col>
        <ion-col class="ion-text-center">
          S/
        </ion-col>
        <ion-col class="ion-text-end">
          <ion-label>{{ sumaVentasAnual | number:'1.2-2' }} </ion-label>
        </ion-col>
      </ion-row>
    </ion-toolbar>

    <ngx-datatable class="material expandable" [rows]="resumenes" [columnMode]="'force'" [headerHeight]="50"
      [footerHeight]="50" [rowHeight]="'auto'">

      <!--  [scrollbarH]="true" -->
      <ngx-datatable-column name='FECHA' prop='Fecha'>
        <ng-template let-row='row' ngx-datatable-cell-template>
          {{ row.Fecha | date: 'MM/yyyy'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name='COMPRAS' prop='Compras'>
        <ng-template let-row='row' ngx-datatable-cell-template>
          <div class="ion-text-end">
            {{ row.Compras | number:'1.2-2' }}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name='VENTAS' prop='Ventas'>
        <ng-template let-row='row' ngx-datatable-cell-template>
          <div class="ion-text-end">
            {{ row.Ventas | number:'1.2-2' }}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name='FOTO' prop='Foto' [sortable]='false'>
        <ng-template let-row='row' ngx-datatable-cell-template>
          <div (click)='verFoto(row)' *ngIf='row.NombreFoto' class="ion-text-center">
            <ion-thumbnail>
              <ion-img [src]="row.Foto" alt='{{ row.NombreFoto }}'></ion-img>
            </ion-thumbnail>
            <ion-note class="nombreFoto" color='primary'>{{ row.NombreFoto }}</ion-note>
          </div>
          <div *ngIf='!row.NombreFoto' class="ion-text-center">
            <ion-label> -- </ion-label>
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name='DECLARAR' [sortable]='false'>
        <ng-template let-row='row' ngx-datatable-cell-template>
          <ion-icon [name]='row.NombreFoto ? "pencil" : "shield-checkmark"' class="icon-button-2" color='danger'
            (click)='agregarFoto(row)'></ion-icon>
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>
  </ion-card-content>
  
  <br>
  <ion-card-content>
    <ion-toolbar color='danger'>
      <ion-row>
        <ion-col class="ion-text-center">
          COMPRAS/VENTAS MENSUALES - AÑO {{ anio | date:'yyyy'}}
        </ion-col>
      </ion-row>
    </ion-toolbar>
    <ion-row>
      <ion-item class="grafico">
        <div id='chart-barras'>
          <ngx-charts-bar-vertical-2d [scheme]="colorScheme" [results]="graficoBarras" [xAxis]="true" [yAxis]="true"
            [showXAxisLabel]="true" [showYAxisLabel]="true" [xAxisLabel]="'Mes'" [yAxisLabel]="'Monto'" [legend]="true">
          </ngx-charts-bar-vertical-2d>
        </div>
      </ion-item>
    </ion-row>
  </ion-card-content>
  <br>
  <ion-card-content>
    <ion-toolbar color='danger'>
      <ion-row>
        <ion-col class="ion-text-center">
          COMPRAS/VENTAS ANUALES - AÑO {{ anio | date:'yyyy'}}
        </ion-col>
      </ion-row>
    </ion-toolbar>

    <ion-row>
      <ion-item class="grafico">
        <div id='chart-pie'>
          <ngx-charts-advanced-pie-chart [scheme]="colorScheme" [results]="graficoCircular" [gradient]="true">
          </ngx-charts-advanced-pie-chart>
        </div>
      </ion-item>
    </ion-row>
  </ion-card-content>
  <br>

  <ion-card-content>
    <ion-toolbar color='danger'>
      <ion-row>
        <ion-col class="ion-text-center">
          COMPRAS/VENTAS TODOS LOS AÑOS
        </ion-col>
      </ion-row>
    </ion-toolbar>
    <ion-row>
      <ion-item class="grafico">
        <div id='chart-barras-total'>
          <ngx-charts-bar-vertical-2d [scheme]="colorScheme" [results]="graficoBarrasTotal" [xAxis]="true"
            [yAxis]="true" [showXAxisLabel]="true" [showYAxisLabel]="true" [xAxisLabel]="'Año'" [yAxisLabel]="'Monto'" [legend]="true">
          </ngx-charts-bar-vertical-2d>
        </div>
      </ion-item>
    </ion-row>
  </ion-card-content>
  <br>
</ion-content>